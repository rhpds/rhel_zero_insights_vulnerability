#!/bin/bash
LOG=/root/setup-log
#LOG=/dev/null
hostnamectl set-hostname rhel-$(uuidgen | cut -c 32-)
subscription-manager config --rhsm.manage_repos=1 >> $LOG
subscription-manager register --activationkey=${ACTIVATION_KEY} --org=12451665 --force >> $LOG
dnf downgrade -y libksba-1.5.1-4.el9 >> $LOG
dnf -y install rhc-worker-playbook ansible-core rhc >> $LOG

# Write the hostname of the vm into a runtime variable.
agent variable set VM_HOSTNAME $(hostname -f)

subscription-manager unregister >> $LOG
subscription-manager clean >> $LOG

rhc connect --organization 12451665 --activation-key ${ACTIVATION_KEY} >> $LOG

#rhc connect >> $LOG
#insights-client >> $LOG
exec $SHELL